{% extends "layout.html" %}

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/instructions.css') }}" />
  <script src="{{ url_for('static', filename='js/constant.js') }}" /></script>
  <script src="{{ url_for('static', filename='js/instructions.js') }}" /></script>
{% endblock %}


{% block content %}
<div class="container">
  <h1>Detailed Documentation</h1>
  <p>
    This page documents the features of the tool and the full query language.
    Please read the <a href="/getting-started">getting started</a> guide first
    if you have not done so already.
  </p>
  <hr>
</div>

<div class="container">
  <h3>How do I write queries?</h3>
  <p>
    Screen time queries are broken in to several parts. A query has the form
    <div class="code-block">
      <code>
        <b>COUNT</b> "screen time" <b>WHERE</b>
          filter1="value1" <b>AND</b> filter2="value2" <b>AND</b> ...
      </code>
    </div>

    consisting of the data being counted ("screen time") and filters, separated
    by "AND". In the getting started guide, we saw two filters "{{ search_keys.face_name }}" and
    "{{ search_keys.channel }}", and their respective values "hillary clinton" and "CNN".
    The table below shows the filter options that the application currently supports.
  </p>

  <table class="table table-striped table-bordered table-sm">
    <tbody>
      <tr>
        <th colspan="3">Supported filter options and their usage</th>
      </tr>
    </tbody>

    <tbody>
      <tr>
        <td rowspan="4">{{ search_keys.channel }}</td>
        <td>description</td>
        <td>name of the channel</td>
      </tr>
      <tr>
        <td>values</td>
        <td>CNN, FOX, MSNBC</td>
      </tr>
      <tr>
        <td>default</td>
        <td>
          <var>all</var>
        </td>
      </tr>
      <tr>
        <td>example</td>
        <td><code>{{ search_keys.channel }}="CNN"</code></td>
      </tr>
    </tbody>

    <tbody>
      <tr>
        <td rowspan="4">{{ search_keys.show }}</td>
        <td>description</td>
        <td>name of the show</td>
      </tr>
      <tr>
        <td>values</td>
        <td><a href="/data/shows" target="_blank">list of shows</a></td>
      </tr>
      <tr>
        <td>default</td>
        <td>
          <var>all</var>
        </td>
      </tr>
      <tr>
        <td>example</td>
        <td><code>{{ search_keys.show }}="CNN Newsroom"</code></td>
      </tr>
    </tbody>

    <tbody>
      <tr>
        <td rowspan="4">{{ search_keys.hour }}</td>
        <td>description</td>
        <td>ranges (inclusive) of hours in 24h format in Eastern Time</td>
      </tr>
      <tr>
        <td>values</td>
        <td>0-23 or 0, 1, 2, ...</td>
      </tr>
      <tr>
        <td>default</td>
        <td>
          <var>0-23</var>
        </td>
      </tr>
      <tr>
        <td>example</td>
        <td><code>{{ search_keys.hour }}="9-17"</code></td>
      </tr>
    </tbody>

    <tbody>
      <tr>
        <td rowspan="4">{{ search_keys.day_of_week }}</td>
        <td>description</td>
        <td>range (inclusive) or list of days of the week</td>
      </tr>
      <tr>
        <td>values</td>
        <td>mon-sun or mon, tue, ...</td>
      </tr>
      <tr>
        <td>default</td>
        <td>
          <var>all</var>
        </td>
      </tr>
      <tr>
        <td>example</td>
        <td><code>{{ search_keys.days_of_week }}="sat-sun"</code></td>
      </tr>
    </tbody>

    <tbody>
      <tr>
        <td rowspan="4">{{ search_keys.text }}</td>
        <td>description</td>
        <td>keywords nearby in the captions</td>
      </tr>
      <tr>
        <td>values</td>
        <td>keywords or phrases. Use <code>|</code> for "or".
            See <a href='/data/transcripts'>here for more details.
        </td>
      </tr>
      <tr>
        <td>default</td>
        <td>n/a</td>
      </tr>
      <tr>
        <td>example</td>
        <td>
          <code>{{ search_keys.text }}="affordable care act"</code><br>
          <code>{{ search_keys.text }}="affordable care act | obamacare"</code><br>
        </td>
      </tr>
    </tbody>

    <tbody>
      <tr>
        <td rowspan="4">{{ search_keys.text_window }}</td>
        <td>description</td>
        <td>threshold (in seconds) for windows around keywords</td>
      </tr>
      <tr>
        <td>values</td>
        <td>keyword or phrase</td>
      </tr>
      <tr>
        <td>default</td>
        <td>
          <var>{{ default_text_window }}</var>
        </td>
      </tr>
      <tr>
        <td>example</td>
        <td><code>{{ search_keys.text_window }}={{ default_text_window }}</code></td>
      </tr>
    </tbody>

    <tbody>
      <tr>
        <td rowspan="4">
          {{ search_keys.face_name }}<br>
        </td>
        <td>description</td>
        <td>
          constrain results to when the person specified is on screen.
        </td>
      </tr>
      <tr>
        <td>values</td>
        <td>
          <i>name</i> <a href="/data/people" target="_blank">(list of people)</a>
        </td>
      </tr>
      <tr>
        <td>default</td>
        <td>n/a</td>
      </tr>
      <tr>
        <td>example</td>
        <td>
          <code>
            {{ search_keys.face_name }}="Barack Obama"
          </code>
        </td>
      </tr>
    </tbody>

    <tbody>
      <tr>
        <td rowspan="4">
          {{ search_keys.face_tag }}<br>
        </td>
        <td>description</td>
        <td>
          constrain results to when a face with the tag(s) is on screen.
          Multiple tags can be specified with commas.
        </td>
      </tr>
      <tr>
        <td>values</td>
        <td>
          (fe)male, (non)host,
          <i>tag on person</i> <a href="/data/tags" target="_blank">(list of tags)</a>
        </td>
      </tr>
      <tr>
        <td>default</td>
        <td>n/a</td>
      </tr>
      <tr>
        <td>example</td>
        <td>
          <code>
            {{ search_keys.face_tag }}="male" <br>
            {{ search_keys.face_tag }}="male,host" <br>
            {{ search_keys.face_tag }}="male AND host" <br>
            {{ search_keys.face_tag }}="journalist"
          </code>
        </td>
      </tr>
    </tbody>

    <tbody>
      <tr>
        <td rowspan="4">{{ search_keys.face_count }}</td>
        <td>description</td>
        <td>number of faces on screeen.</td>
      </tr>
      <tr>
        <td>values</td>
        <td>1 or more</td>
      </tr>
      <tr>
        <td>default</td>
        <td>n/a</td>
      </tr>
      <tr>
        <td>example</td>
        <td><code>{{ search_keys.face_count }}=2</code></td>
      </tr>
    </tbody>
  </table>

  <hr>

  <h3>How to I normalize my queries?</h3>
  <p>
    So far, all of the queries have returned raw counts. In order to express
    queries such as the proportion of screen time where there is a man or woman
    on screen, we need to introduce a NORMALIZE operator.
    This used in the following way:

    <div class="code-block">
      <code>query1 <b>NORMALIZE</b> query2</code>
    </div>

    Succintly put, NORMALIZE allows you to normalize one query by another query.
    For instance, to express the proportion of the data set that is CNN, we can
    write:

    <div class="code-block">
      <code>
        <b>COUNT</b> "screen time" <b>WHERE</b>
        {{ search_keys.channel }}="CNN" <b>NORMALIZE</b>
      </code>
    </div>

    Likewise, to express the proportion of time when a man is on screen on CNN,
    we can write:

    <iframe width="100%" height="0" id="normCNNMan"></iframe>

  </p>

  <hr>
  <h3>Can I add and subtract queries?</h3>
  <p>
    Addition is not supported. Subtraction can be expressed as:

    <div class="code-block">
      <code>query1 <b>SUBTRACT</b> query2</code>
    </div>

    For example, the net screen time of two individuals can be computed as follows:
    <iframe width="100%" height="0" id="subClintonSanders"></iframe>
  </p>

  <script>
    initialize();
    setIframeSource(
      '#normCNNMan', [
        '{{ search_keys.face_tag }}=male AND {{ search_keys.channel }}=CNN NORMALIZE {{ search_keys.channel }}=CNN'
      ], 600, 300);
    setIframeSource(
      '#subClintonSanders', [
        '{{ search_keys.face_name }}=hillary clinton SUBTRACT {{ search_keys.face_name }}=female'
      ], 600, 300);
  </script>
</div>
{% endblock %}
